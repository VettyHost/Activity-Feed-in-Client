<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidate Profile - Activity Feed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- jsPDF AutoTable plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Custom styles for the timeline */
        .activity-item {
            position: relative;
            padding-left: 30px;
            padding-bottom: 20px;
        }

        .activity-item:before {
            content: '';
            position: absolute;
            left: -5px;
            top: 4px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: #cbd5e1;
            border: 4px solid #f8fafc;
            z-index: 10;
        }

        .activity-item:not(:last-child):after {
            content: '';
            position: absolute;
            left: 3px;
            top: 22px;
            bottom: -20px;
            width: 2px;
            background-color: #e2e8f0;
        }

        .activity-item.highlight-red:before {
            background-color: #ef4444;
        }
    </style>
</head>

<body class="bg-gray-50 font-sans p-4 md:p-8">

    <!-- Error Display Container -->
    <div id="error-container" class="hidden w-full p-4 mb-4 bg-red-100 text-red-700 border border-red-300 rounded-lg">
        <h3 class="font-bold">Application Error</h3>
        <p id="error-message"></p>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="max-w-7xl mx-auto">

        <!-- Header Card -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 mb-8">
            <div class="flex flex-col md:flex-row justify-between">
                <!-- Left Column: Name and Status -->
                <div class="flex-shrink-0 mb-4 md:mb-0">
                    <div class="flex items-center">
                         <img src="https://placehold.co/40x40/e0e0e0/7f7f7f?text=DR" alt="logo" class="h-10 w-10 rounded-full mr-3">
                        <h1 class="text-2xl font-bold text-gray-900">Debendu Roy</h1>
                    </div>
                    <div class="mt-2">
                        <span class="inline-block bg-blue-600 text-white text-sm font-medium px-4 py-1 rounded-full">In Progress (0% complete)</span>
                    </div>
                    <div class="mt-4">
                        <select class="border border-gray-300 rounded-md p-2 text-sm">
                            <option>Screening Tags</option>
                        </select>
                    </div>
                </div>

                <!-- Right Column: Action Links -->
                <div class="flex items-start space-x-6 text-sm font-medium text-gray-600">
                    <a href="#" class="flex items-center hover:text-blue-600">
                         <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                        Add New Checks
                    </a>
                    <a href="#" class="flex items-center hover:text-blue-600">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        Documents and Disclosures
                    </a>
                    <a href="#" class="flex items-center hover:text-blue-600">
                         <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8C9.79 8 8 9.79 8 12s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 6c-1.11 0-2.08-.402-2.599-1M12 14c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z"></path></svg>
                        Cost Summary
                    </a>
                </div>
            </div>

            <hr class="my-6 border-gray-200">

            <!-- Candidate Details Grid (Web UI) -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-8 gap-y-4 text-sm">
                <!-- Col 1 -->
                <div><span class="text-gray-500">Added By</span><p class="text-gray-900 font-medium">Testing Covid</p></div>
                <!-- Col 2 -->
                <div><span class="text-gray-500">Date Of Birth</span><p class="text-gray-900 font-medium">11/01/XXXX <a href="#" class="text-blue-600 font-medium">View</a></p></div>
                <!-- Reserved -->
                <div></div><div></div>

                <!-- Col 1 -->
                <div><span class="text-gray-500">Package</span><p class="text-gray-900 font-medium">19 test package</p></div>
                <!-- Col 2 -->
                <div><span class="text-gray-500">Address</span><p class="text-gray-900 font-medium">Test, Phoenix, AZ, 85001</p></div>

                <!-- Col 1 -->
                <div><span class="text-gray-500">Department</span><p class="text-gray-900 font-medium">Department Dev</p></div>
                <!-- Col 2 -->
                <div><span class="text-gray-500">Email Address</span><p class="text-gray-900 font-medium">debendu.roy@vetty.co</p></div>

                <!-- Col 1 -->
                <div><span class="text-gray-500">Location</span><p class="text-gray-900 font-medium">Pune</p></div>
                <!-- Col 2 -->
                <div><span class="text-gray-500">Phone #</span><p class="text-gray-900 font-medium">(222) 222-2222</p></div>

                 <!-- Col 1 -->
                <div><span class="text-gray-500">Order ID</span><p class="text-gray-900 font-medium">S68ZL</p></div>
                <!-- Col 2 -->
                <div><span class="text-gray-500">Social Security #</span><p class="text-gray-900 font-medium">XXX-XX-2222 <a href="#" class="text-blue-600 font-medium">View</a></p></div>
                
                 <!-- Col 1 -->
                <div><span class="text-gray-500">Candidate ID</span><p class="text-gray-900 font-medium">691709b07219ac5545f8aca</p></div>
                <!-- Col 2 -->
                <div><span class="text-gray-500">Expected Annual Salary</span><p class="text-gray-900 font-medium">$1,212,121</p></div>
                
                 <!-- Col 1 -->
                <div><span class="text-gray-500">uniq id</span><p class="text-gray-900 font-medium"><a href="#" class="text-blue-600 font-medium">Add</a></p></div>
                 <!-- Col 2 -->
                <div></div>
                
                 <!-- Col 1 -->
                <div><span class="text-gray-500">Expected Employment</span><p class="text-gray-900 font-medium">11/26/25 <a href="#" class="text-blue-600 font-medium">Edit</a></p></div>
                 <!-- Col 2 -->
                <div></div>
                
                  <!-- Col 1 -->
                <div><span class="text-gray-500">Start Date</span><p class="text-gray-900 font-medium"></p></div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Left Column: Actions & Activity Feed -->
            <div class="lg:col-span-1">
                <!-- Actions -->
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Actions</h2>
                    <a href="#" class="text-sm font-medium text-blue-600 hover:underline">More Actions...</a>
                </div>

                <!-- Activity Feed Header -->
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">Activity Feed</h2>
                    <button id="exportButton" class="text-sm font-medium text-blue-600 hover:underline flex items-center">
                         <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Export Activity Feed
                    </button>
                </div>

                <!-- Activity Timeline -->
                <div id="timelineContainer" class="relative border-l-2 border-gray-200 ml-3">
                    <!-- Activity items will be dynamically injected here -->
                </div>
            </div>

            <!-- Right Column: Verified Profile -->
            <div class="lg:col-span-2">
                <h2 class="text-xl font-semibold text-gray-800 mb-6">Verified Profile</h2>
                <!-- Background Screening Card -->
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">Background Screening</h3>
                    </div>
                    
                    <span class="text-xs font-medium text-gray-500 uppercase">IDENTITY</span>
                    <div class="flex justify-between items-center py-3 border-b border-gray-200">
                        <span class="text-gray-800">Social Security Trace</span>
                        <span class="bg-blue-600 text-white text-xs font-medium px-2.5 py-0.5 rounded-full">In Progress</span>
                    </div>

                    <span class="text-xs font-medium text-gray-500 uppercase mt-4 inline-block">ADVANCED CRIMINAL</span>
                     <div class="flex justify-between items-center py-3">
                        <span class="text-gray-800">Federal Criminal Check</span>
                        <span class="bg-blue-600 text-white text-xs font-medium px-2.5 py-0.5 rounded-full">In Progress</span>
                    </div>
                </div>
            </div>
        </div>
    </div> 


    <script>
        // --- DATA ---
        const candidateData = {
            "Candidate": "Debendu Roy",
            "Package": "19 test package",
            "Department": "Department Dev",
            "Location": "Pune",
            "Order ID": "S68ZL",
            "Candidate ID": "691709b07219ac5545f8aca",
            "Email": "debendu.roy@vetty.co",
            "Phone": "(222) 222-2222",
            "DOB": "11/01/XXXX",
            "Address": "Test, Phoenix, AZ, 85001",
            "SSN": "XXX-XX-2222",
            "Salary": "$1,212,121"
        };
        
        // Correct Chronological Order (Newest First)
        // Background screening (oldest) at bottom. Vetty Reminded (newest) at top.
        const activityFeedData = [
            { date: "11/15/25", time: "10:00 AM", detail: "Vetty Reminded Debendu To Complete The Form I-9.", highlight: false },
            { date: "11/14/25", time: "10:15 AM", detail: "Debendu Has Not Completed Their I-9 Form.", highlight: true },
            { date: "11/14/25", time: "10:00 AM", detail: "Vetty Reminded Debendu To Complete The Form I-9.", highlight: false },
            { date: "11/14/25", time: "09:45 AM", detail: "Vetty Reminded Debendu To Complete The Form I-9.", highlight: false },
            { date: "11/14/25", time: "09:30 AM", detail: "Background Screening Started", highlight: false }
        ];

        // --- FUNCTIONS ---

        function renderActivityFeed() {
            const container = document.getElementById('timelineContainer');
            if (!container) return;
            container.innerHTML = ''; 

            activityFeedData.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'activity-item';
                if (item.highlight) {
                    itemDiv.classList.add('highlight-red');
                }

                const detailSpan = document.createElement('span');
                detailSpan.className = `text-sm ${item.highlight ? 'text-red-600 font-medium' : 'text-gray-700'}`;
                detailSpan.textContent = item.detail;

                const dateSpan = document.createElement('span');
                dateSpan.className = 'block text-xs text-gray-500 mt-1';
                dateSpan.textContent = `${item.date}`; 

                itemDiv.appendChild(detailSpan);
                itemDiv.appendChild(dateSpan);
                container.appendChild(itemDiv);
            });
        }


        function exportActivityFeedPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 15;
            let y = 15;

            // --- 1. TOP HEADER (Vetty Style) ---
            
            // Logo (Text representation for simplicity, but styled)
            doc.setFont("helvetica", "bold");
            doc.setFontSize(24);
            doc.setTextColor("#3b82f6"); // Blue
            doc.text("Vetty", margin, y + 5); // Simulating logo
            
            // Address (Gray, Small)
            doc.setFontSize(8);
            doc.setFont("helvetica", "normal");
            doc.setTextColor("#6b7280");
            doc.text("1205 BMC Drive, Suite 601, Cedar Park, TX 78613", margin + 35, y);
            doc.text("855-468-2889 | www.vetty.co", margin + 35, y + 4);

            // Right Side Header Info
            const rightMargin = pageWidth - margin;
            doc.setFontSize(9);
            doc.setTextColor("#000000");

            doc.setFont("helvetica", "bold");
            doc.text("REQUESTING COMPANY", rightMargin, y, { align: "right" });
            doc.setFont("helvetica", "normal");
            doc.text("Bluetext client", rightMargin, y + 4, { align: "right" });

            doc.setFont("helvetica", "bold");
            doc.text("PACKAGE NAME", rightMargin, y + 10, { align: "right" });
            doc.setFont("helvetica", "normal");
            doc.text(candidateData["Package"], rightMargin, y + 14, { align: "right" }); // Using variable

            doc.setFont("helvetica", "bold");
            doc.text("COMPLETION DATE", rightMargin, y + 20, { align: "right" });
            doc.setFont("helvetica", "normal");
            doc.text("11-27-2025", rightMargin, y + 24, { align: "right" });

            y += 35; // Move down

            // "Activity Feed Report" Title and Timestamp
            doc.setFont("helvetica", "bold");
            doc.setFontSize(14);
            doc.setTextColor("#000000");
            doc.text("Activity Feed Report", margin, y);
            
            // Dynamic Timestamp
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            const timeStr = now.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit', hour12: true });
            const timeZone = new Intl.DateTimeFormat('en-US', { timeZoneName: 'short' }).formatToParts(now).find(part => part.type === 'timeZoneName')?.value || '';

            const timestampStr = `Generated: ${day}-${month}-${year}, ${timeStr} ${timeZone}`;
            
            doc.setFont("helvetica", "normal");
            doc.setFontSize(10);
            doc.setTextColor("#6b7280"); // Gray text
            doc.text(timestampStr, margin, y + 6);

            y += 15;

            // --- 2. BLACK CANDIDATE BANNER (REVISED) ---
            // Contains: Title "Candidate Details", then Candidate, Package, Department, Location
            const bannerHeight = 55;
            doc.setFillColor("#000000"); // Black background
            doc.rect(0, y, pageWidth, bannerHeight, 'F');
            
            let bannerY = y + 10;
            const col1 = margin;
            const col2 = margin + 80; // Second column
            
            // Header: "Candidate Details"
            doc.setFont("helvetica", "bold");
            doc.setFontSize(16);
            doc.setTextColor("#FFFFFF");
            doc.text("Candidate Details", col1, bannerY);
            
            bannerY += 15;
            
            // Define fields to show
            // Candidate, Package, Department, Location
            
            // Row 1
            doc.setFontSize(8);
            doc.setTextColor("#cbd5e1"); // Light gray label
            doc.text("CANDIDATE", col1, bannerY);
            doc.text("PACKAGE", col2, bannerY);
            
            bannerY += 5;
            doc.setFontSize(9);
            doc.setTextColor("#FFFFFF"); // White value
            doc.text(candidateData["Candidate"], col1, bannerY);
            doc.text(candidateData["Package"], col2, bannerY);
            
            bannerY += 12; // Gap between rows
            
            // Row 2
            doc.setFontSize(8);
            doc.setTextColor("#cbd5e1"); // Light gray label
            doc.text("DEPARTMENT", col1, bannerY);
            doc.text("LOCATION", col2, bannerY);
            
            bannerY += 5;
            doc.setFontSize(9);
            doc.setTextColor("#FFFFFF"); // White value
            doc.text(candidateData["Department"], col1, bannerY);
            doc.text(candidateData["Location"], col2, bannerY);

            // Placeholder for geometric graphic (Right side)
            doc.setFillColor("#f43f5e"); // Pinkish red
            doc.circle(pageWidth - 10, y + bannerHeight - 20, 15, 'F');
             doc.setFillColor("#3b82f6"); // Blue
            doc.rect(pageWidth - 25, y + 10, 15, 15, 'F');

            y += bannerHeight + 15;

            // --- 3. ACTIVITY FEED TIMELINE ---
            doc.setFont("helvetica", "bold");
            doc.setFontSize(14);
            doc.setTextColor("#000000");
            doc.text("Activity Feed Timeline", margin, y);
            y += 8;
            
            // Draw a thick line under title
            doc.setLineWidth(0.5);
            doc.line(margin, y, pageWidth - margin, y);
            y += 10;

            const timelineX = margin + 5;
            const contentX = margin + 20;
            const dateX = pageWidth - margin - 40;
            const pageHeight = doc.internal.pageSize.getHeight();

            activityFeedData.forEach((item, index) => {
                 // Page break check
                 if (y > pageHeight - 20) {
                     doc.addPage();
                     y = 20;
                 }

                // Dotted line (vertical)
                if (index < activityFeedData.length - 1) {
                    doc.setDrawColor("#e2e8f0");
                    doc.setLineWidth(1);
                    doc.setLineDash([1, 1], 0); // Dotted line
                    doc.line(timelineX, y, timelineX, y + 15); // Short segment
                    doc.setLineDash([]); // Reset
                }

                // Circle
                const dotColor = item.highlight ? "#ef4444" : "#cbd5e1";
                doc.setFillColor(dotColor);
                doc.setDrawColor("#ffffff");
                doc.setLineWidth(0.5);
                doc.circle(timelineX, y + 2, 3, 'FD');
                
                // Line connection extension
                 if (index < activityFeedData.length - 1) {
                    doc.setDrawColor("#e2e8f0");
                    doc.setLineDash([1, 1], 0); 
                    // Calculate estimated height of this item to draw line to next
                    doc.line(timelineX, y + 5, timelineX, y + 15); 
                    doc.setLineDash([]);
                }

                // Text Content
                doc.setFontSize(10);
                if (item.highlight) {
                    doc.setTextColor("#ef4444");
                    doc.setFont("helvetica", "bold");
                } else {
                    doc.setTextColor("#374151");
                    doc.setFont("helvetica", "normal");
                }
                
                const textLines = doc.splitTextToSize(item.detail, dateX - contentX - 5);
                doc.text(textLines, contentX, y + 3);

                // Date/Time
                doc.setTextColor("#6b7280");
                doc.setFont("helvetica", "normal");
                const dateTimeStr = `${item.date}, ${item.time}`;
                doc.text(dateTimeStr, dateX, y + 3);

                y += (textLines.length * 5) + 12; // Spacing
            });

            doc.save("Vetty_Report.pdf");
        }

        function initializeApp() {
            try {
                renderActivityFeed();
                const exportButton = document.getElementById('exportButton');
                if (exportButton) {
                    exportButton.addEventListener('click', exportActivityFeedPdf);
                } else {
                    console.error("Export button not found!");
                }
            } catch (error) {
                console.error("App Init Error:", error);
            }
        }

        initializeApp();

    </script>

</body>
</html>
