<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidate Profile - Activity Feed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- jsPDF AutoTable plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Custom styles for the timeline */
        .activity-item {
            position: relative;
            padding-left: 30px;
            /* Space for timeline */
            padding-bottom: 20px;
        }

        /* Timeline dot */
        .activity-item:before {
            content: '';
            position: absolute;
            left: -5px;
            top: 4px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: #cbd5e1;
            /* gray-300 */
            border: 4px solid #f8fafc;
            /* bg-gray-50 */
            z-index: 10;
        }

        /* Timeline line */
        .activity-item:not(:last-child):after {
            content: '';
            position: absolute;
            left: 3px;
            top: 22px;
            bottom: -20px;
            width: 2px;
            background-color: #e2e8f0;
            /* gray-200 */
        }

        /* Highlighted/Error state dot */
        .activity-item.highlight-red:before {
            background-color: #ef4444;
            /* red-500 */
        }
    </style>
</head>

<body class="bg-gray-50 font-sans p-4 md:p-8">

    <!-- Error Display Container -->
    <div id="error-container" class="hidden w-full p-4 mb-4 bg-red-100 text-red-700 border border-red-300 rounded-lg">
        <h3 class="font-bold">Application Error</h3>
        <p id="error-message"></p>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="max-w-7xl mx-auto">

        <!-- Header Card -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 mb-8">
            <div class="flex flex-col md:flex-row justify-between">
                <!-- Left Column: Name and Status -->
                <div class="flex-shrink-0 mb-4 md:mb-0">
                    <div class="flex items-center">
                        <img src="https://placehold.co/40x40/e0e0e0/7f7f7f?text=DR" alt="logo" class="h-10 w-10 rounded-full mr-3">
                        <h1 class="text-2xl font-bold text-gray-900">Debendu Roy</h1>
                    </div>
                    <div class="mt-2">
                        <span class="inline-block bg-blue-600 text-white text-sm font-medium px-4 py-1 rounded-full">In Progress (0% complete)</span>
                    </div>
                    <div class="mt-4">
                        <select class="border border-gray-300 rounded-md p-2 text-sm">
                            <option>Screening Tags</option>
                        </select>
                    </div>
                </div>

                <!-- Right Column: Action Links -->
                <div class="flex items-start space-x-6 text-sm font-medium text-gray-600">
                    <a href="#" class="flex items-center hover:text-blue-600">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                        Add New Checks
                    </a>
                    <a href="#" class="flex items-center hover:text-blue-600">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        Documents and Disclosures
                    </a>
                    <a href="#" class="flex items-center hover:text-blue-600">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8C9.79 8 8 9.79 8 12s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 6c-1.11 0-2.08-.402-2.599-1M12 14c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z"></path></svg>
                        Cost Summary
                    </a>
                </div>
            </div>

            <hr class="my-6 border-gray-200">

            <!-- Candidate Details Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-8 gap-y-4 text-sm">
                <!-- Col 1 -->
                <div>
                    <span class="text-gray-500">Added By</span>
                    <p class="text-gray-900 font-medium">Testing Covid</p>
                </div>
                <!-- Col 2 -->
                <div>
                    <span class="text-gray-500">Date Of Birth</span>
                    <p class="text-gray-900 font-medium">11/01/XXXX <a href="#" class="text-blue-600 font-medium">View</a></p>
                </div>
                <!-- Col 3 & 4 (empty in screenshot, reserved) -->
                <div></div>
                <div></div>

                <!-- Col 1 -->
                <div>
                    <span class="text-gray-500">Package</span>
                    <p class="text-gray-900 font-medium">19 test package</p>
                </div>
                <!-- Col 2 -->
                <div>
                    <span class="text-gray-500">Address</span>
                    <p class="text-gray-900 font-medium">Test, Phoenix, AZ, 85001</p>
                </div>

                <!-- Col 1 -->
                <div>
                    <span class="text-gray-500">Department</span>
                    <p class="text-gray-900 font-medium">Department Dev</p>
                </div>
                <!-- Col 2 -->
                <div>
                    <span class="text-gray-500">Email Address</span>
                    <p class="text-gray-900 font-medium">debendu.roy@vetty.co</p>
                </div>

                <!-- Col 1 -->
                <div>
                    <span class="text-gray-500">Location</span>
                    <p class="text-gray-900 font-medium">Pune</p>
                </div>
                <!-- Col 2 -->
                <div>
                    <span class="text-gray-500">Phone #</span>
                    <p class="text-gray-900 font-medium">(222) 222-2222</p>
                </div>

                <!-- Col 1 -->
                <div>
                    <span class="text-gray-500">Order ID</span>
                    <p class="text-gray-900 font-medium">S68ZL</p>
                </div>
                <!-- Col 2 -->
                <div>
                    <span class="text-gray-500">Social Security #</span>
                    <p class="text-gray-900 font-medium">XXX-XX-2222 <a href="#" class="text-blue-600 font-medium">View</a></p>
                </div>

                <!-- Col 1 -->
                <div>
                    <span class="text-gray-500">Candidate ID</span>
                    <p class="text-gray-900 font-medium">691709b07219ac95545f8aca</p>
                </div>
                <!-- Col 2 -->
                <div>
                    <span class="text-gray-500">Expected Annual Salary</span>
                    <p class="text-gray-900 font-medium">$1,212,121</p>
                </div>

                <!-- Col 1 -->
                <div>
                    <span class="text-gray-500">uniq id</span>
                    <p class="text-gray-900 font-medium"><a href="#" class="text-blue-600 font-medium">Add</a></p>
                </div>
                <!-- Col 2 -->
                <div></div>

                <!-- Col 1 -->
                <div>
                    <span class="text-gray-500">Expected Employment</span>
                    <p class="text-gray-900 font-medium">11/26/25 <a href="#" class="text-blue-600 font-medium">Edit</a></p>
                </div>
                <!-- Col 2 -->
                <div></div>
                
                 <!-- Col 1 -->
                <div>
                    <span class="text-gray-500">Start Date</span>
                    <p class="text-gray-900 font-medium"></p>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Left Column: Actions & Activity Feed -->
            <div class="lg:col-span-1">
                <!-- Actions -->
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Actions</h2>
                    <a href="#" class="text-sm font-medium text-blue-600 hover:underline">More Actions...</a>
                </div>

                <!-- Activity Feed Header -->
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">Activity Feed</h2>
                    <button id="exportButton" class="text-sm font-medium text-blue-600 hover:underline flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Export Activity Feed
                    </button>
                </div>

                <!-- Activity Timeline -->
                <div id="timelineContainer" class="relative border-l-2 border-gray-200 ml-3">
                    <!-- Activity items will be dynamically injected here -->
                </div>
            </div>

            <!-- Right Column: Verified Profile -->
            <div class="lg:col-span-2">
                <h2 class="text-xl font-semibold text-gray-800 mb-6">Verified Profile</h2>

                <!-- Background Screening Card -->
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">Background Screening</h3>
                        <!-- Icons can go here -->
                    </div>
                    
                    <span class="text-xs font-medium text-gray-500 uppercase">IDENTITY</span>
                    <div class="flex justify-between items-center py-3 border-b border-gray-200">
                        <span class="text-gray-800">Social Security Trace</span>
                        <span class="bg-blue-600 text-white text-xs font-medium px-2.5 py-0.5 rounded-full">In Progress</span>
                    </div>

                    <span class="text-xs font-medium text-gray-500 uppercase mt-4 inline-block">ADVANCED CRIMINAL</span>
                     <div class="flex justify-between items-center py-3">
                        <span class="text-gray-800">Federal Criminal Check</span>
                        <span class="bg-blue-600 text-white text-xs font-medium px-2.5 py-0.5 rounded-full">In Progress</span>
                    </div>
                </div>
                <!-- Other cards (Motor Vehicle, Onboarding) can be added here -->

            </div>
        </div>
    </div> <!-- End App Container -->


    <script>
        // --- DATA ---
        // Using an object for candidate data for easier PDF generation
        const candidateData = {
            "Candidate": "Debendu Roy",
            "Package": "19 test package",
            "Department": "Department Dev",
            "Location": "Pune",
            "Order ID": "S68ZL",
            "Candidate ID": "691709b07219ac95545f8aca",
            "Email": "debendu.roy@vetty.co",
            "Phone": "(222) 222-2222",
            "DOB": "11/01/XXXX",
            "Address": "Test, Phoenix, AZ, 85001",
            "SSN": "XXX-XX-2222",
            "Salary": "$1,212,121"
        };

        // Data is now REVERSE-CHRONOLOGICAL (newest at top)
        // This matches the user's logic: "latest always remains on top"
        const activityFeedData = [
            { date: "11/15/25", time: "10:00 AM", detail: "Vetty Reminded Debendu To Complete The Form I-9.", highlight: false },
            { date: "11/14/25", time: "10:15 AM", detail: "Debendu Has Not Completed Their I-9 Form.", highlight: true },
            { date: "11/14/25", time: "10:00 AM", detail: "Vetty Reminded Debendu To Complete The Form I-9.", highlight: false },
            { date: "11/14/25", time: "09:45 AM", detail: "Vetty Reminded Debendu To Complete The Form I-9.", highlight: false },
            { date: "11/14/25", time: "09:30 AM", detail: "Background Screening Started", highlight: false }
        ];

        // --- FUNCTIONS ---

        /**
         * Renders the activity feed data into the DOM.
         */
        function renderActivityFeed() {
            const container = document.getElementById('timelineContainer');
            if (!container) {
                console.error("Timeline container not found!");
                return;
            }
            container.innerHTML = ''; // Clear old content

            activityFeedData.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'activity-item';
                if (item.highlight) {
                    itemDiv.classList.add('highlight-red');
                }

                const detailSpan = document.createElement('span');
                detailSpan.className = `text-sm ${item.highlight ? 'text-red-600 font-medium' : 'text-gray-700'}`;
                detailSpan.textContent = item.detail;

                const dateSpan = document.createElement('span');
                dateSpan.className = 'block text-xs text-gray-500 mt-1';
                dateSpan.textContent = `${item.date}`; // UI only shows date

                itemDiv.appendChild(detailSpan);
                itemDiv.appendChild(dateSpan);
                container.appendChild(itemDiv);
            });
        }


        /**
         * Generates and downloads a PDF of the activity feed.
         */
        function exportActivityFeedPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const margin = 15;
            let y = 20; // Initial Y position

            // --- 1. Get Timestamp ---
            const now = new Date();
            const timeZone = new Intl.DateTimeFormat('default', { timeZoneName: 'short' }).formatToParts(now).find(part => part.type === 'timeZoneName')?.value || '';
            const formattedDate = `${String(now.getDate()).padStart(2, '0')}-${String(now.getMonth() + 1).padStart(2, '0')}-${now.getFullYear()}`;
            const formattedTime = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
            const generatedTimestamp = `Generated: ${formattedDate}, ${formattedTime} ${timeZone}`;

            // --- 2. PDF Header ---
            doc.setFillColor("#022e6a"); // Dark Blue
            doc.rect(0, 0, doc.internal.pageSize.getWidth(), 40, 'F');
            doc.setFont("helvetica", "bold");
            doc.setFontSize(18);
            doc.setTextColor("#FFFFFF"); // White
            doc.text("Activity Feed Report", margin, y);
            y += 8;

            doc.setFont("helvetica", "normal");
            doc.setFontSize(10);
            doc.setTextColor("#E0E0E0"); // Light Gray
            doc.text(generatedTimestamp, margin, y);
            y = 55; // Reset Y below the header

            // --- 3. Candidate Details Table ---
            const tableBody = [
                ["Candidate:", candidateData["Candidate"]],
                ["Package:", candidateData["Package"]],
                ["Department:", candidateData["Department"]],
                ["Location:", candidateData["Location"]],
            ];

            doc.autoTable({
                startY: y,
                head: [['Candidate Details', '']],
                body: tableBody,
                theme: 'grid',
                headStyles: {
                    fillColor: [230, 230, 230], // Light gray
                    textColor: [0, 0, 0], // Black
                    fontStyle: 'bold',
                },
                columnStyles: {
                    0: {
                        fontStyle: 'bold',
                        fillColor: [245, 245, 245], // Lighter gray
                        cellWidth: 40,
                    },
                    1: {
                        cellWidth: 'auto'
                    }
                },
                didDrawPage: (data) => {
                    y = data.cursor.y; // Update y position after table
                }
            });

            y += 15; // Add padding after table

            // --- 4. Activity Feed Timeline ---
            doc.setFont("helvetica", "bold");
            doc.setFontSize(14);
            doc.setTextColor("#000000");
            doc.text("Activity Feed Timeline", margin, y);
            y += 4;
            doc.setDrawColor("#000000");
            doc.setLineWidth(0.5);
            doc.line(margin, y, doc.internal.pageSize.getWidth() - margin, y); // Separator line
            y += 10;

            const timelineX = margin + 3; // X for the dots/line
            const textStartX = margin + 18; // X for the text
            const dateX = doc.internal.pageSize.getWidth() - margin - 35; // X for the date

            doc.setFont("helvetica", "normal");
            doc.setFontSize(10);

            const pageHeight = doc.internal.pageSize.getHeight();
            const bottomMargin = 20;

            // Loop through the data array as-is (reverse-chronological)
            activityFeedData.forEach((item, index) => {
                // Check if new page is needed
                const textLines = doc.splitTextToSize(item.detail, dateX - textStartX - 5);
                const itemHeight = (textLines.length * 5) + 10; // 5 per line + padding
                if (y + itemHeight > pageHeight - bottomMargin) {
                    doc.addPage();
                    y = 20; // Reset Y for new page
                }

                // Draw timeline dot
                const dotY = y + 4;
                doc.setDrawColor(item.highlight ? "#E53E3E" : "#CBD5E1"); // Red or Gray
                doc.setFillColor(item.highlight ? "#E53E3A" : "#CBD5E1");
                doc.circle(timelineX, dotY, 3, 'FD');

                // Draw timeline line (if not last item)
                if (index < activityFeedData.length - 1) {
                    doc.setDrawColor("#e2e8f0"); // gray-200
                    doc.setLineWidth(0.5);
                    // Dynamically calculate line height
                    const nextItem = activityFeedData[index + 1];
                    const nextTextLines = doc.splitTextToSize(nextItem.detail, dateX - textStartX - 5);
                    const nextItemHeight = (nextTextLines.length * 5) + 3;
                    doc.line(timelineX, dotY + 5, timelineX, dotY + itemHeight + nextItemHeight - 5);
                }

                // Draw Text
                doc.setTextColor(item.highlight ? "#E53E3E" : "#333333"); // Red or Dark Gray
                doc.setFont("helvetica", item.highlight ? "bold" : "normal");
                doc.text(textLines, textStartX, y + 5);

                // Draw Date & Time
                doc.setTextColor("#555555"); // Medium Gray
                doc.setFont("helvetica", "normal");
                const timeString = `${item.date}, ${item.time}`;
                doc.text(timeString, dateX, y + 5);

                y += itemHeight; // Move y down for the next item
            });

            // --- 5. Save PDF ---
            doc.save(`Activity_Feed_Report_${candidateData.Candidate.replace(' ', '_')}.pdf`);
        }
        
        /**
         * Initializes the application by rendering the feed and attaching event listeners.
         * Wrapped in a try...catch to display errors on-screen.
         */
        function initializeApp() {
            try {
                // 1. Render the dynamic UI content
                renderActivityFeed();

                // 2. Attach event listeners
                const exportButton = document.getElementById('exportButton');
                if (exportButton) {
                    exportButton.addEventListener('click', exportActivityFeedPdf);
                } else {
                    console.error("Export button not found!");
                    throw new Error("Export button element is missing from the DOM.");
                }

            } catch (error) {
                console.error("Failed to initialize application:", error);
                
                // Display the error on the screen
                const errorContainer = document.getElementById('error-container');
                const errorMessage = document.getElementById('error-message');
                const appContainer = document.getElementById('app-container');
                
                if (errorMessage && errorContainer && appContainer) {
                    errorMessage.textContent = error.message || "An unknown error occurred. Check the console for details.";
                    errorContainer.classList.remove('hidden');
                    appContainer.classList.add('hidden'); // Hide the broken app
                }
            }
        }

        // --- EXECUTION ---
        // Call initializeApp directly.
        // The script is at the end of the <body>, so the DOM is ready.
        initializeApp();

    </script>

</body>
</html>
